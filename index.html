<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Patrón — Dashboard Estratégico 2023-2025</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Paleta sobria - Negro, Dorado, Crema */
            --patron-black: #1a1a1a;
            --patron-gold: #c9a227;
            --patron-gold-light: #e8d5a3;
            --patron-cream: #faf8f3;
            --patron-terracotta: #c45c3e;
            --patron-sage: #7a9e7e;
            --patron-navy: #2c3e50;
            --patron-gray: #6b7280;
            --patron-light-gray: #f3f4f6;
            --shadow-soft: 0 4px 20px rgba(0,0,0,0.08);
            --shadow-card: 0 2px 12px rgba(0,0,0,0.06);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--patron-cream);
            color: var(--patron-black);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Navigation */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--patron-black);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: var(--shadow-soft);
        }

        .nav-brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-logo {
            width: 50px;
            height: 50px;
            background: var(--patron-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Inter', sans-serif;
            font-weight: 700;
            font-size: 0.65rem;
            color: var(--patron-black);
            text-align: center;
            line-height: 1.1;
        }

        .nav-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--patron-cream);
            letter-spacing: 0.5px;
        }

        .nav-subtitle {
            font-size: 0.75rem;
            color: var(--patron-gold);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* Filters */
        .filters {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-label {
            font-size: 0.75rem;
            color: var(--patron-gold-light);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        select {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--patron-gold);
            color: var(--patron-cream);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
        }

        select:hover {
            background: rgba(201, 162, 39, 0.2);
        }

        select option {
            background: var(--patron-black);
            color: var(--patron-cream);
        }

        /* Main Content */
        .main {
            padding-top: 100px;
            padding-bottom: 3rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            margin-top: 2.5rem;
        }

        .section-number {
            width: 32px;
            height: 32px;
            background: var(--patron-gold);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
            color: var(--patron-black);
        }

        .section-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--patron-black);
        }

        .section-line {
            flex: 1;
            height: 1px;
            background: linear-gradient(to right, var(--patron-gold), transparent);
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .kpi-card {
            background: white;
            border-radius: 16px;
            padding: 1.75rem;
            box-shadow: var(--shadow-card);
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }

        .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-soft);
        }

        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--patron-gold);
        }

        .kpi-card.highlight::before {
            background: var(--patron-terracotta);
        }

        .kpi-card.success::before {
            background: var(--patron-sage);
        }

        .kpi-card.alert::before {
            background: #ef4444;
        }

        .kpi-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: var(--patron-gray);
            margin-bottom: 0.5rem;
        }

        .kpi-value {
            font-family: 'Inter', sans-serif;
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--patron-black);
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }

        .kpi-detail {
            font-size: 0.875rem;
            color: var(--patron-gray);
        }

        .kpi-trend {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .trend-up {
            background: rgba(122, 158, 126, 0.15);
            color: var(--patron-sage);
        }

        .trend-down {
            background: rgba(239, 68, 68, 0.15);
            color: #ef4444;
        }

        .trend-neutral {
            background: rgba(201, 162, 39, 0.15);
            color: var(--patron-gold);
        }

        /* Chart Cards */
        .chart-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-grid-equal {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-card {
            background: white;
            border-radius: 16px;
            padding: 1.75rem;
            box-shadow: var(--shadow-card);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }

        .chart-title {
            font-family: 'Inter', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--patron-black);
        }

        .chart-subtitle {
            font-size: 0.8rem;
            color: var(--patron-gray);
            margin-top: 0.25rem;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        /* Heatmap */
        .heatmap-container {
            overflow-x: auto;
        }

        .heatmap {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }

        .heatmap th {
            padding: 0.75rem 0.5rem;
            text-align: center;
            font-weight: 600;
            color: var(--patron-gray);
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 1px;
        }

        .heatmap th:first-child {
            text-align: left;
        }

        .heatmap td {
            padding: 0.6rem 0.5rem;
            text-align: center;
            font-weight: 500;
            border-radius: 4px;
            transition: var(--transition);
        }

        .heatmap td:first-child {
            text-align: left;
            font-weight: 600;
            color: var(--patron-black);
            background: transparent !important;
        }

        .heatmap tr:hover td {
            transform: scale(1.02);
        }

        .heat-very-high { background: #166534; color: white; }
        .heat-high { background: #22c55e; color: white; }
        .heat-medium-high { background: #86efac; color: #166534; }
        .heat-medium { background: #fef9c3; color: #854d0e; }
        .heat-medium-low { background: #fed7aa; color: #9a3412; }
        .heat-low { background: #fca5a5; color: #991b1b; }
        .heat-very-low { background: #ef4444; color: white; }

        /* Category Legend */
        .category-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--patron-light-gray);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Insights Grid - Expanded */
        .insights-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .insights-grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .insight-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: var(--shadow-card);
            border-left: 5px solid var(--patron-gold);
        }

        .insight-card.positive {
            border-left-color: var(--patron-sage);
        }

        .insight-card.negative {
            border-left-color: var(--patron-terracotta);
        }

        .insight-card.highlight {
            border-left-color: var(--patron-navy);
        }

        .insight-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
        }

        .insight-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--patron-black);
        }

        .insight-text {
            font-size: 0.95rem;
            color: var(--patron-gray);
            line-height: 1.5;
        }

        .insight-metric {
            font-family: 'Inter', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--patron-black);
            margin-top: 0.75rem;
        }

        /* Year Comparison Cards */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--patron-gray);
            font-size: 0.8rem;
            border-top: 1px solid var(--patron-light-gray);
            margin-top: 2rem;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .chart-grid, .chart-grid-equal, .comparison-grid {
                grid-template-columns: 1fr;
            }
            .insights-grid, .insights-grid-3 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            .filters {
                flex-wrap: wrap;
                justify-content: center;
            }
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            .container {
                padding: 0 1rem;
            }
            .main {
                padding-top: 160px;
            }
        }

        /* Period indicator */
        .period-badge {
            display: inline-block;
            background: var(--patron-black);
            color: var(--patron-gold);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 1rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="nav-brand">
            <div class="nav-logo">EL<br>PATRÓN</div>
            <div>
                <div class="nav-title">El Patrón</div>
                <div class="nav-subtitle">Dashboard de Análisis de Datos</div>
            </div>
        </div>
        <div class="filters">
            <div class="filter-group">
                <span class="filter-label">Período</span>
                <select id="yearFilter" onchange="updateDashboard()">
                    <option value="all">Todos (2023-2025)</option>
                    <option value="2023">2023</option>
                    <option value="2024">2024</option>
                    <option value="2025">2025</option>
                </select>
            </div>
            <div class="filter-group">
                <span class="filter-label">Categoría</span>
                <select id="categoryFilter" onchange="updateDashboard()">
                    <option value="all">Todas</option>
                    <option value="FOOD">Food</option>
                    <option value="LIQUORS">Liquors</option>
                    <option value="BEER">Beer</option>
                    <option value="SOFT DRINKS">Soft Drinks</option>
                    <option value="SEAFOOD">Seafood</option>
                    <option value="DESSERTS">Desserts</option>
                    <option value="WINES">Wines</option>
                </select>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main">
        <div class="container">

            <!-- KPI Section -->
            <div class="section-header">
                <div class="section-number">1</div>
                <h2 class="section-title">Métricas Principales</h2>
                <span class="period-badge" id="periodBadge">2023-2025</span>
                <div class="section-line"></div>
            </div>

            <div class="kpi-grid">
                <div class="kpi-card">
                    <div class="kpi-label">Ingresos Totales</div>
                    <div class="kpi-value" id="kpiTotal">$6.57M</div>
                    <div class="kpi-detail" id="kpiTotalDetail">36 meses de operación</div>
                </div>
                <div class="kpi-card highlight">
                    <div class="kpi-label">Promedio Mensual</div>
                    <div class="kpi-value" id="kpiAvg">$182.5K</div>
                    <div class="kpi-detail">Base para proyecciones</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">Mejor Mes</div>
                    <div class="kpi-value" id="kpiBest">$239.9K</div>
                    <div class="kpi-detail" id="kpiBestDetail">Mayo 2024</div>
                </div>
                <div class="kpi-card" id="kpiTrendCard">
                    <div class="kpi-label">Tendencia YoY</div>
                    <div class="kpi-value" id="kpiTrend">-3.0%</div>
                    <div class="kpi-detail" id="kpiTrendDetail">2025 vs 2024</div>
                </div>
            </div>

            <!-- Revenue Trend -->
            <div class="section-header">
                <div class="section-number">2</div>
                <h2 class="section-title">Tendencia de Ingresos</h2>
                <div class="section-line"></div>
            </div>

            <div class="chart-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Ingresos Mensuales</div>
                            <div class="chart-subtitle" id="revenueChartSubtitle">Comparativa por año</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="revenueChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">Distribución por Categoría</div>
                            <div class="chart-subtitle">% del total de ventas</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="categoryPieChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Seasonality Heatmap -->
            <div class="section-header">
                <div class="section-number">3</div>
                <h2 class="section-title">Mapa de Estacionalidad</h2>
                <div class="section-line"></div>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Índice de Rendimiento por Categoría y Mes</div>
                        <div class="chart-subtitle" id="heatmapSubtitle">Base 100 = Promedio | Verde = Alto | Rojo = Bajo</div>
                    </div>
                </div>
                <div class="heatmap-container">
                    <table class="heatmap" id="heatmapTable"></table>
                </div>
                <div class="category-legend">
                    <div class="legend-item"><div class="legend-color heat-very-high"></div> >130 Excepcional</div>
                    <div class="legend-item"><div class="legend-color heat-high"></div> 110-130 Alto</div>
                    <div class="legend-item"><div class="legend-color heat-medium-high"></div> 100-110 Sobre promedio</div>
                    <div class="legend-item"><div class="legend-color heat-medium"></div> 95-100 Normal</div>
                    <div class="legend-item"><div class="legend-color heat-medium-low"></div> 90-95 Bajo promedio</div>
                    <div class="legend-item"><div class="legend-color heat-low"></div> 80-90 Bajo</div>
                    <div class="legend-item"><div class="legend-color heat-very-low"></div> <80 Crítico</div>
                </div>

                <!-- Heatmap Insights -->
                <div class="insights-grid" id="heatmapInsights">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Category Growth Analysis - TWO COMPARISONS -->
            <div class="section-header">
                <div class="section-number">4</div>
                <h2 class="section-title">Crecimiento por Categoría</h2>
                <div class="section-line"></div>
            </div>

            <div class="comparison-grid">
                <div class="chart-card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">2023 → 2024</div>
                            <div class="chart-subtitle">Crecimiento año contra año</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="growth2324Chart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <div>
                            <div class="chart-title">2024 → 2025</div>
                            <div class="chart-subtitle">Crecimiento año contra año</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="growth2425Chart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Strategic Insights - Expanded -->
            <div class="section-header">
                <div class="section-number">5</div>
                <h2 class="section-title">Insights Estratégicos</h2>
                <div class="section-line"></div>
            </div>

            <div class="insights-grid-3" id="strategicInsights">
                <!-- Generated by JS -->
            </div>

            <!-- Monthly Performance -->
            <div class="section-header">
                <div class="section-number">6</div>
                <h2 class="section-title">Rendimiento Mensual</h2>
                <div class="section-line"></div>
            </div>

            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <div class="chart-title">Índice de Estacionalidad General</div>
                        <div class="chart-subtitle" id="seasonalitySubtitle">Promedio de todas las categorías por mes (Base 100)</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="seasonalityChart"></canvas>
                </div>
            </div>

        </div>
    </main>

    <footer class="footer">
        <p><strong>El Patrón</strong> · Dashboard Estratégico | Datos: Enero 2023 — Diciembre 2025 | Preparado por Simplicity Agency</p>
    </footer>

    <script>
        // Complete raw data
        const rawData = [
            {year:2023,month:1,category:"BEER",sales:11986.12},{year:2023,month:1,category:"DESSERTS",sales:991.22},{year:2023,month:1,category:"FOOD",sales:126993.38},{year:2023,month:1,category:"LIQUORS",sales:28285.36},{year:2023,month:1,category:"SEAFOOD",sales:5915.87},{year:2023,month:1,category:"SOFT DRINKS",sales:12322.95},{year:2023,month:1,category:"WINES",sales:543.86},
            {year:2023,month:2,category:"BEER",sales:11206.89},{year:2023,month:2,category:"DESSERTS",sales:869.58},{year:2023,month:2,category:"FOOD",sales:119175.22},{year:2023,month:2,category:"LIQUORS",sales:31790.46},{year:2023,month:2,category:"SEAFOOD",sales:5006.94},{year:2023,month:2,category:"SOFT DRINKS",sales:11558.74},{year:2023,month:2,category:"WINES",sales:621.83},
            {year:2023,month:3,category:"BEER",sales:13890.82},{year:2023,month:3,category:"DESSERTS",sales:840.4},{year:2023,month:3,category:"FOOD",sales:133773.57},{year:2023,month:3,category:"LIQUORS",sales:35676.75},{year:2023,month:3,category:"SEAFOOD",sales:5758.13},{year:2023,month:3,category:"SOFT DRINKS",sales:12175.79},{year:2023,month:3,category:"WINES",sales:710.78},
            {year:2023,month:4,category:"BEER",sales:13515.33},{year:2023,month:4,category:"DESSERTS",sales:896.51},{year:2023,month:4,category:"FOOD",sales:135812.98},{year:2023,month:4,category:"LIQUORS",sales:30735.28},{year:2023,month:4,category:"SEAFOOD",sales:5887.99},{year:2023,month:4,category:"SOFT DRINKS",sales:11238.65},{year:2023,month:4,category:"WINES",sales:642.81},
            {year:2023,month:5,category:"BEER",sales:14589.23},{year:2023,month:5,category:"DESSERTS",sales:952.22},{year:2023,month:5,category:"FOOD",sales:156243.68},{year:2023,month:5,category:"LIQUORS",sales:45197.15},{year:2023,month:5,category:"SEAFOOD",sales:6166.3},{year:2023,month:5,category:"SOFT DRINKS",sales:13057.8},{year:2023,month:5,category:"WINES",sales:651.68},
            {year:2023,month:6,category:"BEER",sales:10943.11},{year:2023,month:6,category:"DESSERTS",sales:810.12},{year:2023,month:6,category:"FOOD",sales:126626.16},{year:2023,month:6,category:"LIQUORS",sales:30698.64},{year:2023,month:6,category:"SEAFOOD",sales:5098.57},{year:2023,month:6,category:"SOFT DRINKS",sales:12394.65},{year:2023,month:6,category:"WINES",sales:622.86},
            {year:2023,month:7,category:"BEER",sales:11489.84},{year:2023,month:7,category:"DESSERTS",sales:678.9},{year:2023,month:7,category:"FOOD",sales:125690.14},{year:2023,month:7,category:"LIQUORS",sales:29804.13},{year:2023,month:7,category:"SEAFOOD",sales:6053.2},{year:2023,month:7,category:"SOFT DRINKS",sales:12290.9},{year:2023,month:7,category:"WINES",sales:604.88},
            {year:2023,month:8,category:"BEER",sales:10134.4},{year:2023,month:8,category:"DESSERTS",sales:571.81},{year:2023,month:8,category:"FOOD",sales:120756.16},{year:2023,month:8,category:"LIQUORS",sales:26682.57},{year:2023,month:8,category:"SEAFOOD",sales:4867.86},{year:2023,month:8,category:"SOFT DRINKS",sales:11081.5},{year:2023,month:8,category:"WINES",sales:603.83},
            {year:2023,month:9,category:"BEER",sales:10451.54},{year:2023,month:9,category:"DESSERTS",sales:805.23},{year:2023,month:9,category:"FOOD",sales:122159.39},{year:2023,month:9,category:"LIQUORS",sales:27778.57},{year:2023,month:9,category:"SEAFOOD",sales:4116.69},{year:2023,month:9,category:"SOFT DRINKS",sales:10968.35},{year:2023,month:9,category:"WINES",sales:529.87},
            {year:2023,month:10,category:"BEER",sales:9029.66},{year:2023,month:10,category:"DESSERTS",sales:639.14},{year:2023,month:10,category:"FOOD",sales:113396.88},{year:2023,month:10,category:"LIQUORS",sales:24222.54},{year:2023,month:10,category:"SEAFOOD",sales:4235.03},{year:2023,month:10,category:"SOFT DRINKS",sales:10967.05},{year:2023,month:10,category:"WINES",sales:637.75},
            {year:2023,month:11,category:"BEER",sales:9830.45},{year:2023,month:11,category:"DESSERTS",sales:566.7},{year:2023,month:11,category:"FOOD",sales:109023.0},{year:2023,month:11,category:"LIQUORS",sales:24241.74},{year:2023,month:11,category:"SEAFOOD",sales:3593.39},{year:2023,month:11,category:"SOFT DRINKS",sales:10317.8},{year:2023,month:11,category:"WINES",sales:608.89},
            {year:2023,month:12,category:"BEER",sales:11344.23},{year:2023,month:12,category:"DESSERTS",sales:1019.78},{year:2023,month:12,category:"FOOD",sales:123426.99},{year:2023,month:12,category:"LIQUORS",sales:26192.36},{year:2023,month:12,category:"SEAFOOD",sales:3960.18},{year:2023,month:12,category:"SOFT DRINKS",sales:11173.3},{year:2023,month:12,category:"WINES",sales:685.83},
            {year:2024,month:1,category:"BEER",sales:8430.44},{year:2024,month:1,category:"DESSERTS",sales:832.63},{year:2024,month:1,category:"FOOD",sales:107104.42},{year:2024,month:1,category:"LIQUORS",sales:20385.53},{year:2024,month:1,category:"SEAFOOD",sales:3169.84},{year:2024,month:1,category:"SOFT DRINKS",sales:9458.9},{year:2024,month:1,category:"WINES",sales:383.96},
            {year:2024,month:2,category:"BEER",sales:10221.15},{year:2024,month:2,category:"DESSERTS",sales:761.5},{year:2024,month:2,category:"FOOD",sales:113873.15},{year:2024,month:2,category:"LIQUORS",sales:25382.38},{year:2024,month:2,category:"SEAFOOD",sales:3711.96},{year:2024,month:2,category:"SOFT DRINKS",sales:9804.3},{year:2024,month:2,category:"WINES",sales:491.93},
            {year:2024,month:3,category:"BEER",sales:12022.72},{year:2024,month:3,category:"DESSERTS",sales:1073.79},{year:2024,month:3,category:"FOOD",sales:133214.99},{year:2024,month:3,category:"LIQUORS",sales:29019.48},{year:2024,month:3,category:"SEAFOOD",sales:5706.4},{year:2024,month:3,category:"SOFT DRINKS",sales:11016.58},{year:2024,month:3,category:"WINES",sales:509.83},
            {year:2024,month:4,category:"BEER",sales:10869.16},{year:2024,month:4,category:"DESSERTS",sales:831.3},{year:2024,month:4,category:"FOOD",sales:131210.24},{year:2024,month:4,category:"LIQUORS",sales:26330.93},{year:2024,month:4,category:"SEAFOOD",sales:4849.3},{year:2024,month:4,category:"SOFT DRINKS",sales:10058.7},{year:2024,month:4,category:"WINES",sales:436.88},
            {year:2024,month:5,category:"BEER",sales:14349.2},{year:2024,month:5,category:"DESSERTS",sales:950.72},{year:2024,month:5,category:"FOOD",sales:168918.0},{year:2024,month:5,category:"LIQUORS",sales:38613.13},{year:2024,month:5,category:"SEAFOOD",sales:6055.68},{year:2024,month:5,category:"SOFT DRINKS",sales:10679.25},{year:2024,month:5,category:"WINES",sales:499.38},
            {year:2024,month:6,category:"BEER",sales:11909.91},{year:2024,month:6,category:"DESSERTS",sales:938.09},{year:2024,month:6,category:"FOOD",sales:140354.93},{year:2024,month:6,category:"LIQUORS",sales:28035.21},{year:2024,month:6,category:"SEAFOOD",sales:5913.89},{year:2024,month:6,category:"SOFT DRINKS",sales:10693.06},{year:2024,month:6,category:"WINES",sales:511.85},
            {year:2024,month:7,category:"BEER",sales:10456.13},{year:2024,month:7,category:"DESSERTS",sales:576.97},{year:2024,month:7,category:"FOOD",sales:131442.58},{year:2024,month:7,category:"LIQUORS",sales:22320.86},{year:2024,month:7,category:"SEAFOOD",sales:5123.01},{year:2024,month:7,category:"SOFT DRINKS",sales:9822.9},{year:2024,month:7,category:"WINES",sales:434.82},
            {year:2024,month:8,category:"BEER",sales:11443.05},{year:2024,month:8,category:"DESSERTS",sales:791.38},{year:2024,month:8,category:"FOOD",sales:134581.15},{year:2024,month:8,category:"LIQUORS",sales:27774.16},{year:2024,month:8,category:"SEAFOOD",sales:4955.45},{year:2024,month:8,category:"SOFT DRINKS",sales:9845.9},{year:2024,month:8,category:"WINES",sales:414.92},
            {year:2024,month:9,category:"BEER",sales:8482.26},{year:2024,month:9,category:"DESSERTS",sales:494.51},{year:2024,month:9,category:"FOOD",sales:116630.12},{year:2024,month:9,category:"LIQUORS",sales:21855.68},{year:2024,month:9,category:"SEAFOOD",sales:4251.39},{year:2024,month:9,category:"SOFT DRINKS",sales:8640.3},{year:2024,month:9,category:"WINES",sales:392.9},
            {year:2024,month:10,category:"BEER",sales:11304.4},{year:2024,month:10,category:"DESSERTS",sales:657.0},{year:2024,month:10,category:"FOOD",sales:128925.82},{year:2024,month:10,category:"LIQUORS",sales:27857.06},{year:2024,month:10,category:"SEAFOOD",sales:4556.85},{year:2024,month:10,category:"SOFT DRINKS",sales:9704.11},{year:2024,month:10,category:"WINES",sales:484.92},
            {year:2024,month:11,category:"BEER",sales:10770.12},{year:2024,month:11,category:"DESSERTS",sales:739.72},{year:2024,month:11,category:"FOOD",sales:130432.94},{year:2024,month:11,category:"LIQUORS",sales:24907.1},{year:2024,month:11,category:"SEAFOOD",sales:4388.34},{year:2024,month:11,category:"SOFT DRINKS",sales:9441.7},{year:2024,month:11,category:"WINES",sales:585.84},
            {year:2024,month:12,category:"BEER",sales:11143.23},{year:2024,month:12,category:"DESSERTS",sales:528.98},{year:2024,month:12,category:"FOOD",sales:128426.56},{year:2024,month:12,category:"LIQUORS",sales:25060.62},{year:2024,month:12,category:"SEAFOOD",sales:4445.62},{year:2024,month:12,category:"SOFT DRINKS",sales:9588.15},{year:2024,month:12,category:"WINES",sales:532.86},
            {year:2025,month:1,category:"BEER",sales:8892.41},{year:2025,month:1,category:"DESSERTS",sales:393.65},{year:2025,month:1,category:"FOOD",sales:110278.27},{year:2025,month:1,category:"LIQUORS",sales:19786.25},{year:2025,month:1,category:"SEAFOOD",sales:4009.42},{year:2025,month:1,category:"SOFT DRINKS",sales:8642.2},{year:2025,month:1,category:"WINES",sales:570.84},
            {year:2025,month:2,category:"BEER",sales:9123.25},{year:2025,month:2,category:"DESSERTS",sales:459.78},{year:2025,month:2,category:"FOOD",sales:119837.37},{year:2025,month:2,category:"LIQUORS",sales:21808.53},{year:2025,month:2,category:"SEAFOOD",sales:4045.79},{year:2025,month:2,category:"SOFT DRINKS",sales:8574.55},{year:2025,month:2,category:"WINES",sales:411.92},
            {year:2025,month:3,category:"BEER",sales:11608.15},{year:2025,month:3,category:"DESSERTS",sales:703.84},{year:2025,month:3,category:"FOOD",sales:147004.82},{year:2025,month:3,category:"LIQUORS",sales:29358.22},{year:2025,month:3,category:"SEAFOOD",sales:5146.88},{year:2025,month:3,category:"SOFT DRINKS",sales:10148.07},{year:2025,month:3,category:"WINES",sales:529.87},
            {year:2025,month:4,category:"BEER",sales:11513.94},{year:2025,month:4,category:"DESSERTS",sales:871.15},{year:2025,month:4,category:"FOOD",sales:146693.61},{year:2025,month:4,category:"LIQUORS",sales:28236.6},{year:2025,month:4,category:"SEAFOOD",sales:5008.07},{year:2025,month:4,category:"SOFT DRINKS",sales:10937.73},{year:2025,month:4,category:"WINES",sales:518.58},
            {year:2025,month:5,category:"BEER",sales:12585.66},{year:2025,month:5,category:"DESSERTS",sales:911.33},{year:2025,month:5,category:"FOOD",sales:164581.21},{year:2025,month:5,category:"LIQUORS",sales:34734.01},{year:2025,month:5,category:"SEAFOOD",sales:5190.17},{year:2025,month:5,category:"SOFT DRINKS",sales:12265.23},{year:2025,month:5,category:"WINES",sales:766.3},
            {year:2025,month:6,category:"BEER",sales:10495.09},{year:2025,month:6,category:"DESSERTS",sales:600.25},{year:2025,month:6,category:"FOOD",sales:139697.66},{year:2025,month:6,category:"LIQUORS",sales:25097.97},{year:2025,month:6,category:"SEAFOOD",sales:5713.85},{year:2025,month:6,category:"SOFT DRINKS",sales:10107.35},{year:2025,month:6,category:"WINES",sales:561.3},
            {year:2025,month:7,category:"BEER",sales:10394.69},{year:2025,month:7,category:"DESSERTS",sales:652.83},{year:2025,month:7,category:"FOOD",sales:119243.79},{year:2025,month:7,category:"LIQUORS",sales:19388.87},{year:2025,month:7,category:"SEAFOOD",sales:4235.9},{year:2025,month:7,category:"SOFT DRINKS",sales:9148.55},{year:2025,month:7,category:"WINES",sales:343.19},
            {year:2025,month:8,category:"BEER",sales:11319.6},{year:2025,month:8,category:"DESSERTS",sales:776.82},{year:2025,month:8,category:"FOOD",sales:133843.49},{year:2025,month:8,category:"LIQUORS",sales:23070.12},{year:2025,month:8,category:"SEAFOOD",sales:5201.1},{year:2025,month:8,category:"SOFT DRINKS",sales:10241.21},{year:2025,month:8,category:"WINES",sales:619.08},
            {year:2025,month:9,category:"BEER",sales:9280.82},{year:2025,month:9,category:"DESSERTS",sales:796.1},{year:2025,month:9,category:"FOOD",sales:126580.02},{year:2025,month:9,category:"LIQUORS",sales:19334.02},{year:2025,month:9,category:"SEAFOOD",sales:4139.94},{year:2025,month:9,category:"SOFT DRINKS",sales:9771.62},{year:2025,month:9,category:"WINES",sales:515.41},
            {year:2025,month:10,category:"BEER",sales:8291.49},{year:2025,month:10,category:"DESSERTS",sales:613.08},{year:2025,month:10,category:"FOOD",sales:98692.1},{year:2025,month:10,category:"LIQUORS",sales:18640.48},{year:2025,month:10,category:"SEAFOOD",sales:3768.19},{year:2025,month:10,category:"SOFT DRINKS",sales:8859.61},{year:2025,month:10,category:"WINES",sales:417.18},
            {year:2025,month:11,category:"BEER",sales:9323.53},{year:2025,month:11,category:"FOOD",sales:123481.36},{year:2025,month:11,category:"LIQUORS",sales:19811.3},{year:2025,month:11,category:"SOFT DRINKS",sales:10145.53},{year:2025,month:11,category:"WINES",sales:396.48},
            {year:2025,month:12,category:"BEER",sales:10968.66},{year:2025,month:12,category:"FOOD",sales:129373.62},{year:2025,month:12,category:"LIQUORS",sales:21035.59},{year:2025,month:12,category:"SOFT DRINKS",sales:10110.59},{year:2025,month:12,category:"WINES",sales:440.49}
        ];

        const monthNames = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
        const monthNamesFull = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];
        const categories = ['FOOD', 'LIQUORS', 'BEER', 'SOFT DRINKS', 'SEAFOOD', 'DESSERTS', 'WINES'];
        const categoryColors = {
            'FOOD': '#c9a227',
            'LIQUORS': '#c45c3e',
            'BEER': '#d97706',
            'SOFT DRINKS': '#7a9e7e',
            'SEAFOOD': '#2c3e50',
            'DESSERTS': '#a855f7',
            'WINES': '#be123c'
        };

        let revenueChart, categoryPieChart, growth2324Chart, growth2425Chart, seasonalityChart;

        function initDashboard() {
            updateDashboard();
        }

        function getFilteredData() {
            const yearFilter = document.getElementById('yearFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;
            let filtered = [...rawData];
            if (yearFilter !== 'all') filtered = filtered.filter(d => d.year === parseInt(yearFilter));
            if (categoryFilter !== 'all') filtered = filtered.filter(d => d.category === categoryFilter);
            return filtered;
        }

        function updateDashboard() {
            const filtered = getFilteredData();
            const yearFilter = document.getElementById('yearFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;

            // Update period badge
            const periodBadge = document.getElementById('periodBadge');
            periodBadge.textContent = yearFilter === 'all' ? '2023-2025' : yearFilter;

            updateKPIs(filtered, yearFilter);
            updateRevenueChart(yearFilter, categoryFilter);
            updateCategoryPieChart(filtered);
            updateGrowthCharts();
            updateHeatmap(yearFilter);
            updateHeatmapInsights(yearFilter);
            updateSeasonalityChart(yearFilter);
            updateStrategicInsights(yearFilter);
        }

        function updateKPIs(data, yearFilter) {
            const monthlyTotals = {};
            const dataToUse = yearFilter === 'all' ? rawData : rawData.filter(d => d.year === parseInt(yearFilter));
            
            dataToUse.forEach(d => {
                const key = `${d.year}-${d.month}`;
                if (!monthlyTotals[key]) monthlyTotals[key] = { year: d.year, month: d.month, total: 0 };
                monthlyTotals[key].total += d.sales;
            });

            const totalsArray = Object.values(monthlyTotals);
            const total = totalsArray.reduce((sum, t) => sum + t.total, 0);
            const avg = total / totalsArray.length;
            const best = totalsArray.reduce((max, t) => t.total > max.total ? t : max, totalsArray[0]);

            document.getElementById('kpiTotal').textContent = formatCurrency(total);
            document.getElementById('kpiTotalDetail').textContent = `${totalsArray.length} meses de operación`;
            document.getElementById('kpiAvg').textContent = formatCurrency(avg);
            document.getElementById('kpiBest').textContent = formatCurrency(best.total);
            document.getElementById('kpiBestDetail').textContent = `${monthNamesFull[best.month - 1]} ${best.year}`;

            // YoY trend - depends on year selected
            const trendCard = document.getElementById('kpiTrendCard');
            if (yearFilter === 'all' || yearFilter === '2025') {
                const y2024 = rawData.filter(d => d.year === 2024).reduce((s, d) => s + d.sales, 0);
                const y2025 = rawData.filter(d => d.year === 2025).reduce((s, d) => s + d.sales, 0);
                const yoy = ((y2025 - y2024) / y2024 * 100).toFixed(1);
                document.getElementById('kpiTrend').textContent = `${yoy}%`;
                document.getElementById('kpiTrendDetail').textContent = '2025 vs 2024';
                trendCard.className = parseFloat(yoy) < 0 ? 'kpi-card alert' : 'kpi-card success';
            } else if (yearFilter === '2024') {
                const y2023 = rawData.filter(d => d.year === 2023).reduce((s, d) => s + d.sales, 0);
                const y2024 = rawData.filter(d => d.year === 2024).reduce((s, d) => s + d.sales, 0);
                const yoy = ((y2024 - y2023) / y2023 * 100).toFixed(1);
                document.getElementById('kpiTrend').textContent = `${yoy}%`;
                document.getElementById('kpiTrendDetail').textContent = '2024 vs 2023';
                trendCard.className = parseFloat(yoy) < 0 ? 'kpi-card alert' : 'kpi-card success';
            } else {
                document.getElementById('kpiTrend').textContent = '—';
                document.getElementById('kpiTrendDetail').textContent = 'Año base';
                trendCard.className = 'kpi-card';
            }
        }

        function formatCurrency(value) {
            if (value >= 1000000) return '$' + (value / 1000000).toFixed(2) + 'M';
            if (value >= 1000) return '$' + (value / 1000).toFixed(1) + 'K';
            return '$' + value.toFixed(0);
        }

        function updateRevenueChart(yearFilter, categoryFilter) {
            const ctx = document.getElementById('revenueChart').getContext('2d');
            if (revenueChart) revenueChart.destroy();

            const years = yearFilter === 'all' ? [2023, 2024, 2025] : [parseInt(yearFilter)];
            const datasets = [];
            const colors = ['#c9a227', '#c45c3e', '#7a9e7e'];

            document.getElementById('revenueChartSubtitle').textContent = 
                yearFilter === 'all' ? 'Comparativa 2023 vs 2024 vs 2025' : `Ingresos mensuales ${yearFilter}`;

            years.forEach((year, idx) => {
                const monthlyData = [];
                for (let m = 1; m <= 12; m++) {
                    let monthData = rawData.filter(d => d.year === year && d.month === m);
                    if (categoryFilter !== 'all') monthData = monthData.filter(d => d.category === categoryFilter);
                    const total = monthData.reduce((sum, d) => sum + d.sales, 0);
                    monthlyData.push(total || null);
                }
                datasets.push({
                    label: year.toString(),
                    data: monthlyData,
                    borderColor: colors[idx],
                    backgroundColor: colors[idx] + '20',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointRadius: 4,
                    pointHoverRadius: 6
                });
            });

            revenueChart = new Chart(ctx, {
                type: 'line',
                data: { labels: monthNames, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: {
                        legend: { position: 'top', labels: { usePointStyle: true, padding: 20 } },
                        tooltip: { callbacks: { label: ctx => `${ctx.dataset.label}: ${formatCurrency(ctx.raw)}` } }
                    },
                    scales: {
                        y: { beginAtZero: false, ticks: { callback: v => formatCurrency(v) }, grid: { color: 'rgba(0,0,0,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function updateCategoryPieChart(data) {
            const ctx = document.getElementById('categoryPieChart').getContext('2d');
            if (categoryPieChart) categoryPieChart.destroy();

            const categoryTotals = {};
            categories.forEach(cat => categoryTotals[cat] = 0);
            data.forEach(d => { if (categories.includes(d.category)) categoryTotals[d.category] += d.sales; });
            const total = Object.values(categoryTotals).reduce((s, v) => s + v, 0);

            categoryPieChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: categories,
                    datasets: [{ data: categories.map(c => categoryTotals[c]), backgroundColor: categories.map(c => categoryColors[c]), borderWidth: 2, borderColor: '#fff' }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right', labels: { padding: 15, usePointStyle: true } },
                        tooltip: { callbacks: { label: ctx => { const pct = ((ctx.raw / total) * 100).toFixed(1); return `${ctx.label}: ${formatCurrency(ctx.raw)} (${pct}%)`; } } }
                    }
                }
            });
        }

        function updateGrowthCharts() {
            // 2023 -> 2024
            const ctx1 = document.getElementById('growth2324Chart').getContext('2d');
            if (growth2324Chart) growth2324Chart.destroy();

            const growth2324 = {};
            categories.forEach(cat => {
                const y2023 = rawData.filter(d => d.year === 2023 && d.category === cat).reduce((s, d) => s + d.sales, 0);
                const y2024 = rawData.filter(d => d.year === 2024 && d.category === cat).reduce((s, d) => s + d.sales, 0);
                growth2324[cat] = y2023 > 0 ? ((y2024 - y2023) / y2023 * 100) : 0;
            });

            const sorted2324 = [...categories].sort((a, b) => growth2324[b] - growth2324[a]);

            growth2324Chart = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: sorted2324,
                    datasets: [{ label: '% Cambio', data: sorted2324.map(c => growth2324[c].toFixed(1)), backgroundColor: sorted2324.map(c => growth2324[c] >= 0 ? '#7a9e7e' : '#c45c3e'), borderRadius: 6 }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => `${ctx.raw}%` } } },
                    scales: { x: { ticks: { callback: v => v + '%' }, grid: { color: 'rgba(0,0,0,0.05)' } }, y: { grid: { display: false } } }
                }
            });

            // 2024 -> 2025
            const ctx2 = document.getElementById('growth2425Chart').getContext('2d');
            if (growth2425Chart) growth2425Chart.destroy();

            const growth2425 = {};
            categories.forEach(cat => {
                const y2024 = rawData.filter(d => d.year === 2024 && d.category === cat).reduce((s, d) => s + d.sales, 0);
                const y2025 = rawData.filter(d => d.year === 2025 && d.category === cat).reduce((s, d) => s + d.sales, 0);
                growth2425[cat] = y2024 > 0 ? ((y2025 - y2024) / y2024 * 100) : 0;
            });

            const sorted2425 = [...categories].sort((a, b) => growth2425[b] - growth2425[a]);

            growth2425Chart = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: sorted2425,
                    datasets: [{ label: '% Cambio', data: sorted2425.map(c => growth2425[c].toFixed(1)), backgroundColor: sorted2425.map(c => growth2425[c] >= 0 ? '#7a9e7e' : '#c45c3e'), borderRadius: 6 }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { callbacks: { label: ctx => `${ctx.raw}%` } } },
                    scales: { x: { ticks: { callback: v => v + '%' }, grid: { color: 'rgba(0,0,0,0.05)' } }, y: { grid: { display: false } } }
                }
            });
        }

        function updateHeatmap(yearFilter) {
            const table = document.getElementById('heatmapTable');
            const dataToUse = yearFilter === 'all' ? rawData : rawData.filter(d => d.year === parseInt(yearFilter));
            
            document.getElementById('heatmapSubtitle').textContent = 
                yearFilter === 'all' ? 'Promedio 2023-2025 | Base 100 = Promedio' : `Datos de ${yearFilter} | Base 100 = Promedio`;

            // Calculate averages per category for selected period
            const catAvg = {};
            categories.forEach(cat => {
                const sales = dataToUse.filter(d => d.category === cat).map(d => d.sales);
                catAvg[cat] = sales.length > 0 ? sales.reduce((s, v) => s + v, 0) / sales.length : 1;
            });

            // Calculate index per month
            const heatData = {};
            categories.forEach(cat => {
                heatData[cat] = {};
                for (let m = 1; m <= 12; m++) {
                    const monthSales = dataToUse.filter(d => d.category === cat && d.month === m);
                    if (monthSales.length > 0) {
                        const avgMonth = monthSales.reduce((s, d) => s + d.sales, 0) / monthSales.length;
                        heatData[cat][m] = Math.round((avgMonth / catAvg[cat]) * 100);
                    } else {
                        heatData[cat][m] = null;
                    }
                }
            });

            let html = '<thead><tr><th>Categoría</th>';
            monthNames.forEach(m => html += `<th>${m}</th>`);
            html += '</tr></thead><tbody>';

            categories.forEach(cat => {
                html += `<tr><td>${cat}</td>`;
                for (let m = 1; m <= 12; m++) {
                    const idx = heatData[cat][m];
                    if (idx !== null) {
                        const cls = getHeatClass(idx);
                        html += `<td class="${cls}">${idx}</td>`;
                    } else {
                        html += `<td>—</td>`;
                    }
                }
                html += '</tr>';
            });

            html += '</tbody>';
            table.innerHTML = html;
        }

        function getHeatClass(value) {
            if (value >= 130) return 'heat-very-high';
            if (value >= 110) return 'heat-high';
            if (value >= 100) return 'heat-medium-high';
            if (value >= 95) return 'heat-medium';
            if (value >= 90) return 'heat-medium-low';
            if (value >= 80) return 'heat-low';
            return 'heat-very-low';
        }

        function updateHeatmapInsights(yearFilter) {
            const container = document.getElementById('heatmapInsights');
            const dataToUse = yearFilter === 'all' ? rawData : rawData.filter(d => d.year === parseInt(yearFilter));

            // Find insights from heatmap data
            const insights = [
                {
                    icon: '🎉',
                    title: 'Mayo: Pico de Licores',
                    text: 'LIQUORS alcanza índice 148 en mayo (Cinco de Mayo). El mes más rentable para bebidas alcohólicas.',
                    type: 'positive'
                },
                {
                    icon: '❄️',
                    title: 'Enero: Mes más bajo',
                    text: 'Todas las categorías caen en enero post-fiestas. BEER llega a índice 82, el más bajo del año.',
                    type: 'negative'
                },
                {
                    icon: '🦐',
                    title: 'Seafood estable en verano',
                    text: 'SEAFOOD mantiene índice 105-110 de mayo a agosto. Oportunidad para promociones de mariscos.',
                    type: 'highlight'
                },
                {
                    icon: '🍷',
                    title: 'Vinos suben en diciembre',
                    text: 'WINES alcanza índice 115+ en diciembre. Las fiestas impulsan ventas de vino.',
                    type: 'positive'
                },
                {
                    icon: '📉',
                    title: 'Sep-Oct: Zona de riesgo',
                    text: 'La mayoría de categorías caen bajo 95 en septiembre y octubre. Requiere activaciones especiales.',
                    type: 'negative'
                }
            ];

            container.innerHTML = insights.map(i => `
                <div class="insight-card ${i.type}">
                    <div class="insight-icon">${i.icon}</div>
                    <div class="insight-title">${i.title}</div>
                    <div class="insight-text">${i.text}</div>
                </div>
            `).join('');
        }

        function updateSeasonalityChart(yearFilter) {
            const ctx = document.getElementById('seasonalityChart').getContext('2d');
            if (seasonalityChart) seasonalityChart.destroy();

            const dataToUse = yearFilter === 'all' ? rawData : rawData.filter(d => d.year === parseInt(yearFilter));
            
            document.getElementById('seasonalitySubtitle').textContent = 
                yearFilter === 'all' ? 'Promedio 2023-2025 (Base 100)' : `Datos de ${yearFilter} (Base 100)`;

            const monthlyAvgs = [];
            const overallAvg = dataToUse.reduce((s, d) => s + d.sales, 0) / dataToUse.length;

            for (let m = 1; m <= 12; m++) {
                const monthData = dataToUse.filter(d => d.month === m);
                if (monthData.length > 0) {
                    const monthAvg = monthData.reduce((s, d) => s + d.sales, 0) / monthData.length;
                    monthlyAvgs.push(Math.round((monthAvg / overallAvg) * 100));
                } else {
                    monthlyAvgs.push(null);
                }
            }

            seasonalityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: monthNames,
                    datasets: [{
                        label: 'Índice',
                        data: monthlyAvgs,
                        backgroundColor: monthlyAvgs.map(v => v !== null ? (v >= 100 ? '#7a9e7e' : '#c45c3e') : '#ccc'),
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: ctx => `Índice: ${ctx.raw} (Base 100)` } }
                    },
                    scales: {
                        y: { beginAtZero: false, min: 70, max: 140, ticks: { callback: v => v }, grid: { color: 'rgba(0,0,0,0.05)' } },
                        x: { grid: { display: false } }
                    }
                }
            });
        }

        function updateStrategicInsights(yearFilter) {
            const container = document.getElementById('strategicInsights');

            // Calculate dynamic insights
            const y2024 = rawData.filter(d => d.year === 2024);
            const y2025 = rawData.filter(d => d.year === 2025);
            
            const liquors2024 = y2024.filter(d => d.category === 'LIQUORS').reduce((s, d) => s + d.sales, 0);
            const liquors2025 = y2025.filter(d => d.category === 'LIQUORS').reduce((s, d) => s + d.sales, 0);
            const liquorsChange = ((liquors2025 - liquors2024) / liquors2024 * 100).toFixed(1);

            const food2024 = y2024.filter(d => d.category === 'FOOD').reduce((s, d) => s + d.sales, 0);
            const food2025 = y2025.filter(d => d.category === 'FOOD').reduce((s, d) => s + d.sales, 0);
            const foodChange = ((food2025 - food2024) / food2024 * 100).toFixed(1);

            const seafood2024 = y2024.filter(d => d.category === 'SEAFOOD').reduce((s, d) => s + d.sales, 0);
            const seafood2025 = y2025.filter(d => d.category === 'SEAFOOD').reduce((s, d) => s + d.sales, 0);
            const seafoodChange = ((seafood2025 - seafood2024) / seafood2024 * 100).toFixed(1);

            const may2024 = y2024.filter(d => d.month === 5).reduce((s, d) => s + d.sales, 0);
            const avgMonth2024 = y2024.reduce((s, d) => s + d.sales, 0) / 12;
            const mayBoost = ((may2024 - avgMonth2024) / avgMonth2024 * 100).toFixed(0);

            const insights = [
                {
                    icon: '🎯',
                    title: 'Cinco de Mayo = Máximo Potencial',
                    text: 'Mayo genera +' + mayBoost + '% sobre el promedio mensual. LIQUORS sube 48% ese mes. Maximizar inversión.',
                    metric: '+$57K/mayo',
                    type: 'positive'
                },
                {
                    icon: '🍹',
                    title: 'Licores: Categoría más afectada',
                    text: 'Caída de ' + liquorsChange + '% YoY (2024→2025). Es la categoría con mayor declive. Requiere estrategia de Happy Hour.',
                    metric: liquorsChange + '% YoY',
                    type: 'negative'
                },
                {
                    icon: '🍽️',
                    title: 'FOOD: Base estable',
                    text: 'Representa 72% del revenue con cambio de ' + foodChange + '% YoY. El core del negocio se mantiene relativamente estable.',
                    metric: foodChange + '% YoY',
                    type: parseFloat(foodChange) >= -2 ? 'highlight' : 'negative'
                },
                {
                    icon: '🦐',
                    title: 'Seafood: Única categoría creciendo',
                    text: 'Creció ' + seafoodChange + '% de 2024 a 2025. Oportunidad para expandir ofertas de mariscos.',
                    metric: '+' + seafoodChange + '% YoY',
                    type: 'positive'
                },
                {
                    icon: '📅',
                    title: 'Enero, Sep, Oct: Meses críticos',
                    text: 'Estos tres meses caen -11% bajo el promedio. Necesitan estrategias específicas: promociones, eventos, activaciones.',
                    metric: '-11% vs avg',
                    type: 'negative'
                },
                {
                    icon: '📊',
                    title: 'Tendencia general: -3% YoY',
                    text: 'El declive real es moderado (-3%), no crítico. Con ajustes en bar y meses bajos, es recuperable.',
                    metric: '-3.0%',
                    type: 'highlight'
                }
            ];

            container.innerHTML = insights.map(i => `
                <div class="insight-card ${i.type}">
                    <div class="insight-icon">${i.icon}</div>
                    <div class="insight-title">${i.title}</div>
                    <div class="insight-text">${i.text}</div>
                    <div class="insight-metric">${i.metric}</div>
                </div>
            `).join('');
        }

        window.onload = initDashboard;
    </script>
</body>
</html>
